<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hawaii PPP Loan Data</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
    <link rel="stylesheet" href="style.css" />
    <style>
      rect {
        cursor: pointer;
        stroke-width: 2;
      }
      rect.disabled {
        fill: transparent !important;
      }
      #chart {
        margin: 0;
        position: relative;
        display: block;
      }
      .tooltip {
        background: #eee;
        box-shadow: 0 0 5px #999999;
        color: #333;
        display: none;
        font-size: 16px;
        left: 130px;
        padding: 10px;
        position: absolute;
        text-align: center;
        top: 95px;
        width: 175px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="navigation">
        <h2>Hawaii PPP Loan Data</h2>
        <div class="description">
          <p>
            As part of the 2020 CARES Act, the Paycheck Protection Program (PPP)
            were government-backed loans made by banks to businesses during the
            COVID-19 crisis. This
            <a
              href="https://publicaccountability.org/datasets/358/ppp-loans/"
              target="_blank"
              >dataset</a
            >
            specifically looks at loans approved between April - August 2020 to
            businesses in Hawaii.
          </p>
        </div>
        <div class="pagination">
          <a href="slide2.html">&laquo;</a>
          <a href="index.html">1</a>
          <a href="slide2.html">2</a>
          <a href="slide3.html" class="active">3</a>
          <a href="slide3.html" class="disabled">&raquo;</a>
        </div>
      </div>
      <div id="content">
        <h4>Business Categories and Jobs Retention</h4>
      </div>
    </div>
    <script>
      // set the dimensions and margins of the graph
      var margin = { top: 10, right: 30, bottom: 30, left: 60 },
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      var svg = d3
        .select("#content")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      //Read the data
      d3.csv("https://kharissa.github.io/cs416/data.csv", function (data) {
        // Add X axis
        var x = d3.scaleLinear().domain([0, 150000]).range([0, width]);
        svg
          .append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3.scaleLinear().domain([0, 510]).range([height, 0]);
        svg.append("g").call(d3.axisLeft(y));

        // Color scale: give me a specie name, I return a color
        var color = d3.scaleOrdinal(d3.schemeCategory20c);

        // Highlight the specie that is hovered
        var highlight = function (d) {
          selected_specie = d.NAICSCodeDefinition;

          d3.selectAll(".dot")
            .transition()
            .duration(200)
            .style("fill", "lightgrey")
            .attr("r", 3);

          d3.selectAll("." + selected_specie)
            .transition()
            .duration(200)
            .style("fill", color(selected_specie))
            .attr("r", 7);
        };

        // Highlight the specie that is hovered
        var doNotHighlight = function () {
          d3.selectAll(".dot")
            .transition()
            .duration(200)
            .style("fill", "lightgrey")
            .attr("r", 5);
        };

        // Add dots
        svg
          .append("g")
          .selectAll("dot")
          .data(data)
          .enter()
          .append("circle")
          .attr("class", function (d) {
            return "dot " + d.NAICSCodeDefinition;
          })
          .attr("cx", function (d) {
            return x(d.LoanAmount);
          })
          .attr("cy", function (d) {
            return y(d.JobsReported);
          })
          .attr("r", 5)
          .style("fill", function (d) {
            return color(d.NAICSCodeDefinition);
          })
          .on("mouseover", highlight)
          .on("mouseleave", doNotHighlight);
      });
    </script>
  </body>
</html>
